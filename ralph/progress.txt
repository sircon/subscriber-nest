# Ralph Progress Log
Started: Mon Jan 19 09:42:21 CET 2026

## Codebase Patterns
- ESP connectors are in `apps/backend/libs/core/src/esp/` and implement `IEspConnector` interface
- EspType enum is defined in `apps/backend/libs/database/src/entities/esp-connection.entity.ts`
- Migrations are in `apps/backend/apps/api/src/migrations/` and use TypeORM's MigrationInterface
- PostgreSQL enums use `ALTER TYPE ... ADD VALUE IF NOT EXISTS` for adding new values (cannot remove values)
- Backend lint command has a pre-existing ESLint config issue (glob patterns ignoring all files)
- Existing connectors use HttpService from @nestjs/axios with firstValueFrom() from rxjs for API calls
- ESP auth varies: Basic Auth (Campaign Monitor), API key in query params (Email Octopus), custom headers (Omeda), Bearer token, etc.
- Some ESPs use compound API keys (e.g., Omeda: "client:appid:inputid") - parse to extract components
- Ghost uses JWT authentication: API key format "siteUrl|id:secret", create JWT with HMAC-SHA256 signing
- SparkPost uses API key directly in Authorization header, supports US/EU regions with "eu|" prefix
- ActiveCampaign uses "accountName|apiKey" format for compound API key; base URL is `https://{accountName}.api-us1.com/api/3`
- Customer.io uses Bearer token auth, supports US/EU regions with "eu|" prefix; segment membership returns IDs only (need to fetch profiles separately)
- Sailthru uses signature-based auth (MD5 hash of secret + sorted values); API key format "apiKey|apiSecret"; subscriber export uses job-based approach
- MailerLite uses Bearer token auth; API URL `https://connect.mailerlite.com/api`; cursor-based pagination via links.next or meta.next_cursor
- PostUp uses Basic Auth with compound API key format "username:password"; API URL `https://api.postup.com/api`; lists = publications, recipients = subscribers
- Constant Contact uses Bearer token auth with OAuth access token; API URL `https://api.cc.email/v3`; cursor-based pagination; contact_lists = publications, contacts = subscribers
- Iterable uses Api-Key header auth; API URL `https://api.iterable.com/api`; lists = publications, users = subscribers; list sizes available in /lists response
- SendGrid uses Bearer token auth; API URL `https://api.sendgrid.com/v3`; marketing/lists = publications, contacts searched via SEGQL query; list contact_count for counts
- Brevo uses `api-key` header auth; API URL `https://api.brevo.com/v3`; contacts/lists = publications, contacts via list contacts endpoint; uniqueSubscribers for counts
- When adding new ESP connectors, update BOTH `EspConnectionService` and `SubscriberSyncService` getConnector() methods (both services have their own connector injection and switch statements)
- Tests use Jest with ts-jest; run `yarn test` in apps/backend; test files use `.spec.ts` extension
- Mock HttpService with jest.fn() and return `of(createMockResponse(data))` from rxjs for mocking API responses
- Use `throwError(() => createMockError(status))` from rxjs to test error handling (401, 403, 429, 500)

---

## Mon Jan 19, 2026 - US-001
- **What was implemented**: Added 14 new ESP types to the EspType enum and created database migration
- **Files changed**:
  - `apps/backend/libs/database/src/entities/esp-connection.entity.ts` - Added 14 new enum values
  - `apps/backend/apps/api/src/migrations/1768745000000-AddNewEspTypes.ts` - Migration to add enum values to PostgreSQL
- **Learnings for future iterations:**
  - PostgreSQL enums cannot have values removed, only added - use `ADD VALUE IF NOT EXISTS`
  - Existing ESP types use snake_case format (e.g., 'campaign_monitor', not 'campaignMonitor')
  - The backend lint command fails due to ESLint config issue, but build passes
- Campaign Monitor uses Basic Auth with API key as username and empty password
- Campaign Monitor organizes lists under clients - need to iterate clients first, then get lists per client
---

## Mon Jan 19, 2026 - US-002
- **What was implemented**: Created Campaign Monitor ESP connector
- **Files changed**:
  - `apps/backend/libs/core/src/esp/campaign-monitor.connector.ts` - New connector implementing IEspConnector interface
- **Learnings for future iterations:**
  - Campaign Monitor uses Basic Auth (API key as username, empty password) - use `Buffer.from(apiKey + ':').toString('base64')`
  - API base URL is `https://api.createsend.com/api/v3.2`
  - Publications = clients' subscriber lists; need to fetch /clients.json then /clients/{id}/lists.json for each
  - Active subscribers at /lists/{listId}/active.json, unsubscribed at /lists/{listId}/unsubscribed.json
  - List stats (including subscriber count) available at /lists/{listId}/stats.json
  - Campaign Monitor supports up to 1000 records per page
---

## Mon Jan 19, 2026 - US-003
- **What was implemented**: Created Email Octopus ESP connector
- **Files changed**:
  - `apps/backend/libs/core/src/esp/email-octopus.connector.ts` - New connector implementing IEspConnector interface
- **Learnings for future iterations:**
  - Email Octopus uses API key authentication via query parameter (`api_key`)
  - API base URL is `https://emailoctopus.com/api/1.6`
  - Lists endpoint: GET /lists, List details: GET /lists/{listId}, Contacts: GET /lists/{listId}/contacts
  - Pagination uses `paging.next` to check for more pages, default limit is 100
  - Subscriber counts available in list details via `counts.subscribed`
  - Status values: SUBSCRIBED, UNSUBSCRIBED, PENDING, BOUNCED
  - Custom fields stored in `fields` object (FirstName, LastName, etc.)
---

## Mon Jan 19, 2026 - US-004
- **What was implemented**: Created Omeda ESP connector
- **Files changed**:
  - `apps/backend/libs/core/src/esp/omeda.connector.ts` - New connector implementing IEspConnector interface
- **Learnings for future iterations:**
  - Omeda is an audience development platform for media companies
  - API key format: "client:appid:inputid" - must be parsed to extract components
  - Base URL includes client identifier: `https://ows.omeda.com/webservices/rest/{client}`
  - Auth headers: `x-omeda-appid` for app ID, optional `x-omeda-inputid` for input ID
  - Products endpoint: GET /products/* (asterisk is required in URLs)
  - Audience query: POST /audience/query/* with ProductIds filter
  - Email status codes: A=Active, O=Opt-out, U=Unsubscribed, B=Bounced, I=Inactive
  - Supports up to 500 records per query with Pagination.Offset/Limit
  - Use CountOnly: true in query payload for efficient subscriber counts
---

## Mon Jan 19, 2026 - US-005
- **What was implemented**: Created Ghost ESP connector
- **Files changed**:
  - `apps/backend/libs/core/src/esp/ghost.connector.ts` - New connector implementing IEspConnector interface
- **Learnings for future iterations:**
  - Ghost uses Admin API with JWT authentication (not simple API key)
  - API key format: "siteUrl|id:secret" where id and secret are hex strings
  - JWT is signed using HMAC-SHA256 with the secret (hex decoded to bytes)
  - JWT header must include `kid` (key ID) and `typ: JWT`, `alg: HS256`
  - JWT payload: `iat`, `exp` (5 min), `aud: '/admin/'`
  - Ghost is single-site, so fetchPublications returns site info from /site/ endpoint
  - Members endpoint: GET /ghost/api/admin/members/ with page/limit params
  - Pagination info in response.meta.pagination (total, next, prev, page, pages)
  - Member status values: free, paid, comped (plus subscribed boolean for email opt-in)
  - Authorization header format: `Ghost {jwt_token}`
---

## Mon Jan 19, 2026 - US-006
- **What was implemented**: Created SparkPost ESP connector
- **Files changed**:
  - `apps/backend/libs/core/src/esp/sparkpost.connector.ts` - New connector implementing IEspConnector interface
- **Learnings for future iterations:**
  - SparkPost uses API key directly in Authorization header (no "Bearer" prefix)
  - Supports US and EU regions - use "eu|" prefix for EU (e.g., "eu|actual_api_key")
  - API base URL: `https://api.sparkpost.com/api/v1` (US) or `https://api.eu.sparkpost.com/api/v1` (EU)
  - Recipient lists are the publication equivalent: GET /recipient-lists
  - Recipients in a list: GET /recipient-lists/{id} with `show_recipients=true`
  - Subscriber count available via `total_accepted_recipients` in list metadata
  - No explicit status field - infer from `suppressed` or metadata fields
  - Name stored in `address.name` as full name - need to split for firstName/lastName
  - Custom data stored in `substitution_data` object
---

## Mon Jan 19, 2026 - US-007
- **What was implemented**: Created ActiveCampaign ESP connector
- **Files changed**:
  - `apps/backend/libs/core/src/esp/active-campaign.connector.ts` - New connector implementing IEspConnector interface
- **Learnings for future iterations:**
  - ActiveCampaign uses compound API key format: "accountName|apiKey"
  - API base URL is account-specific: `https://{accountName}.api-us1.com/api/3`
  - Authentication via `Api-Token` header (not Authorization header)
  - Lists endpoint: GET /lists with pagination via limit/offset params
  - Contacts endpoint: GET /contacts with `listid` param to filter by list
  - Status is numeric: 0=unconfirmed, 1=active, 2=unsubscribed, 3=bounced
  - Custom fields are in `fieldValues` array with `field` and `value` properties
  - List details include `subscriber_count` for efficient count queries
  - Default page size is 100
---

## Mon Jan 19, 2026 - US-008
- **What was implemented**: Created Customer.io ESP connector
- **Files changed**:
  - `apps/backend/libs/core/src/esp/customer-io.connector.ts` - New connector implementing IEspConnector interface
- **Learnings for future iterations:**
  - Customer.io uses Bearer token authentication with App API key
  - Supports US and EU regional data centers - use "eu|" prefix for EU (e.g., "eu|actual_api_key")
  - API base URL: `https://api.customer.io/v1` (US) or `https://api-eu.customer.io/v1` (EU)
  - Publications = segments; GET /segments endpoint returns all segments
  - Segment membership: GET /segments/{id}/membership returns only customer IDs
  - Must fetch individual customer profiles via GET /customers/{id}/attributes
  - Segment details include `count` or `customer_count` for subscriber counts
  - Customer attributes use Unix timestamps (seconds) for dates like `created_at`
  - Status inferred from `unsubscribed`, `email_bounced`, `email_pending` boolean fields
  - Custom fields are stored in flat structure on customer object
---

## Mon Jan 19, 2026 - US-009
- **What was implemented**: Created Sailthru ESP connector
- **Files changed**:
  - `apps/backend/libs/core/src/esp/sailthru.connector.ts` - New connector implementing IEspConnector interface
- **Learnings for future iterations:**
  - Sailthru uses signature-based authentication with API key and secret pair
  - API key format: "apiKey|apiSecret" (compound format separated by pipe)
  - Signature = MD5(secret + sorted_values_concatenated) for request signing
  - API base URL: `https://api.sailthru.com`
  - Lists are identified by name (not numeric ID) in Sailthru
  - GET /list returns all lists, GET /list?list={name} for specific list details
  - Subscriber export requires job-based approach: POST /job with job='export_list_data'
  - Must poll job status until complete, then download export file from export_url
  - Export format is JSON lines (one JSON object per line)
  - List details include `email_count` for subscriber counts
  - Status inferred from: optout_email (unsubscribed), hardbounce_time (bounced), valid (invalid)
  - Profile data contains first_name, last_name, or name field for full name
---

## Mon Jan 19, 2026 - US-010
- **What was implemented**: Created MailerLite ESP connector
- **Files changed**:
  - `apps/backend/libs/core/src/esp/mailerlite.connector.ts` - New connector implementing IEspConnector interface
- **Learnings for future iterations:**
  - MailerLite uses Bearer token authentication (Authorization: Bearer {api_key})
  - API base URL is `https://connect.mailerlite.com/api` (MailerLite Connect/New API)
  - Publications = groups; GET /groups endpoint returns all groups
  - Subscribers: GET /subscribers with filter[group]={group_id} to filter by group
  - Uses cursor-based pagination via links.next or meta.next_cursor
  - Group details include `active_count` for subscriber counts
  - Status values: active, unsubscribed, bounced, junk, unconfirmed
  - First name may be in fields.name or fields.first_name
  - Tags returned as array of objects with name property
---

## Mon Jan 19, 2026 - US-011
- **What was implemented**: Created PostUp ESP connector
- **Files changed**:
  - `apps/backend/libs/core/src/esp/postup.connector.ts` - New connector implementing IEspConnector interface
- **Learnings for future iterations:**
  - PostUp uses Basic Auth with compound API key format: "username:password" (colon-separated)
  - API base URL is `https://api.postup.com/api`
  - Publications = lists (mailing lists); GET /list endpoint returns all lists
  - Subscribers = recipients; GET /recipient with listId param to filter by list
  - Uses limit/offset pagination (limit up to 500 per request)
  - List details include `recipientCount` for subscriber counts
  - Status values: A=Active, U=Unsubscribed, H=Hard Bounce, S=Soft Bounce, C=Complaint, P=Pending
  - Demographics (custom fields) stored in `demographics` object
  - List IDs referenced by `listId`, recipient IDs by `recipientId`
---

## Mon Jan 19, 2026 - US-012
- **What was implemented**: Created Constant Contact ESP connector
- **Files changed**:
  - `apps/backend/libs/core/src/esp/constant-contact.connector.ts` - New connector implementing IEspConnector interface
- **Learnings for future iterations:**
  - Constant Contact uses OAuth 2.0 with Bearer token authentication (access token as API key)
  - API base URL is `https://api.cc.email/v3`
  - Publications = contact_lists; GET /contact_lists endpoint returns all lists
  - Subscribers = contacts; GET /contacts with `lists` param to filter by list ID
  - Uses cursor-based pagination via `cursor.next` field in response
  - Account validation via GET /account/summary endpoint
  - List details include `membership_count` for subscriber counts (use `include_membership_count=all`)
  - Contact status based on `permission_to_send`: implicit, explicit, pending_confirmation, unsubscribed, temp_hold, not_set
  - Custom fields stored in `custom_fields` array with `custom_field_id` and `value`
  - Max 50 records for lists, 500 for contacts per API request
---

## Mon Jan 19, 2026 - US-013
- **What was implemented**: Created Iterable ESP connector
- **Files changed**:
  - `apps/backend/libs/core/src/esp/iterable.connector.ts` - New connector implementing IEspConnector interface
- **Learnings for future iterations:**
  - Iterable is a growth marketing platform supporting email, SMS, and push
  - Uses `Api-Key` header for authentication (not Authorization header)
  - API base URL is `https://api.iterable.com/api`
  - Publications = lists; GET /lists endpoint returns all lists with sizes
  - Subscribers fetched via GET /lists/getUsers (returns emails/IDs), then individual user profiles via GET /users/{email}
  - List `size` field contains subscriber count
  - User data stored in `dataFields` object (firstName, lastName, custom fields)
  - Status inferred from: unsubscribedChannelIds (channel 0 = email), bounced, hardBounced, spamComplaint, emailVerified
  - User identifier can be email or userId
---

## Mon Jan 19, 2026 - US-014
- **What was implemented**: Created SendGrid ESP connector
- **Files changed**:
  - `apps/backend/libs/core/src/esp/sendgrid.connector.ts` - New connector implementing IEspConnector interface
- **Learnings for future iterations:**
  - SendGrid uses Bearer token authentication (Authorization: Bearer {api_key})
  - API base URL is `https://api.sendgrid.com/v3`
  - Publications = marketing lists; GET /marketing/lists returns all lists with contact_count
  - Subscribers = contacts; searched via POST /marketing/contacts/search using SEGQL query format
  - Query syntax for list filtering: `CONTAINS(list_ids, '{list_id}')`
  - Individual list details available at GET /marketing/lists/{id}
  - Uses page_token pagination via _metadata.next field in response
  - Contact status inferred from: unsubscribed_at, email_status (bounced, invalid, spam_reported, pending)
  - Custom fields stored in `custom_fields` object on contact
  - Contacts include geo data: city, state_province_region, country, postal_code
---

## Mon Jan 19, 2026 - US-015
- **What was implemented**: Created Brevo (formerly Sendinblue) ESP connector
- **Files changed**:
  - `apps/backend/libs/core/src/esp/brevo.connector.ts` - New connector implementing IEspConnector interface
- **Learnings for future iterations:**
  - Brevo uses `api-key` header for authentication (not Authorization header)
  - API base URL is `https://api.brevo.com/v3`
  - Publications = contacts/lists; GET /contacts/lists returns all lists with subscriber counts
  - Subscribers: GET /contacts/lists/{listId}/contacts with limit/offset pagination
  - List details include `uniqueSubscribers` and `totalSubscribers` for counts
  - Status inferred from: emailBlacklisted (unsubscribed), hardBounced, softBounced, spamReported
  - Attributes stored in `attributes` object (FIRSTNAME, LASTNAME, etc. - uppercase keys)
  - Account validation via GET /account endpoint
  - Max 50 lists per request, 500 contacts per request
---

## Mon Jan 19, 2026 - US-016
- **What was implemented**: Registered all 14 new ESP connectors in the ESP module
- **Files changed**:
  - `apps/backend/libs/core/src/esp/esp.module.ts` - Added imports and registrations for all new connectors
- **Learnings for future iterations:**
  - NestJS modules require connectors to be added to both `providers` and `exports` arrays for proper dependency injection
  - Organizing imports and provider arrays with comments (// Existing connectors, // New connectors) improves readability
  - All connectors in esp/ directory follow the naming pattern: `{provider-name}.connector.ts` with class `{ProviderName}Connector`
  - After adding providers to the module, services can inject them via constructor injection
---

## Mon Jan 19, 2026 - US-017
- **What was implemented**: Updated EspConnectionService to support all 14 new ESP connectors
- **Files changed**:
  - `apps/backend/apps/api/src/services/esp-connection.service.ts` - Added imports, constructor injection, and switch cases for all new connectors
- **Learnings for future iterations:**
  - EspConnectionService has a `getConnector()` method that maps EspType enum values to connector instances
  - Services need to import connectors from `@app/core/esp/{connector-name}.connector` path alias
  - NestJS dependency injection works well with multiple connectors - just add them to the constructor
  - The switch statement pattern with explicit cases for each ESP type ensures type safety and clear mapping
  - Error message in default case automatically covers unsupported ESP types without needing manual updates
---

## Mon Jan 19, 2026 - US-018
- **What was implemented**: Updated SubscriberSyncService to support all 14 new ESP connectors
- **Files changed**:
  - `apps/backend/libs/core/src/sync/subscriber-sync.service.ts` - Added imports, constructor injection, and switch cases for all new connectors
- **Learnings for future iterations:**
  - SubscriberSyncService follows the same pattern as EspConnectionService for connector mapping
  - Both services need to be updated in tandem when adding new ESP connectors
  - Import path for connectors in libs/core/src/sync uses relative paths (e.g., `../esp/active-campaign.connector`)
  - Import path in apps/api/src/services uses path alias (e.g., `@app/core/esp/active-campaign.connector`)
  - When adding new ESPs, update both EspConnectionService AND SubscriberSyncService getConnector() methods
---

## Mon Jan 19, 2026 - US-019
- **What was implemented**: Created comprehensive integration tests for all 14 ESP connectors
- **Files changed**:
  - `apps/backend/package.json` - Added Jest dependencies (jest, ts-jest, @types/jest) and test scripts
  - `apps/backend/jest.config.js` - New Jest configuration with TypeScript support and path mappings
  - `apps/backend/libs/core/src/esp/esp-connectors.integration.spec.ts` - 109 integration tests for all connectors
  - `.gitignore` - Added patterns to exclude build artifacts from src directories
- **Learnings for future iterations:**
  - Jest configuration for NestJS requires ts-jest transform and module path mappings matching tsconfig.json
  - Test files should use `.spec.ts` extension for Jest discovery
  - Mock HttpService using jest.fn() and return of(createMockResponse(data)) for testing connectors
  - NestJS Test.createTestingModule() allows injecting mock services into connectors
  - Error handling tests use throwError(() => createMockError(statusCode)) from rxjs
  - When connectors spread original data at end of object literals (`...contact`), raw values can override mapped values
  - Integration tests cover: validateApiKey, fetchPublications, fetchSubscribers, getSubscriberCount
  - Error handling covers: 401 Unauthorized, 403 Forbidden, 429 Rate Limit, 500 Server Error
  - NestJS build outputs .js, .d.ts, and .js.map files in src directories - add to .gitignore
---

## Mon Jan 19, 2026 - US-043
- **What was implemented**: Updated database schema to store list names alongside publication IDs
- **Files changed**:
  - `apps/backend/libs/database/src/entities/esp-connection.entity.ts` - Added listNames field as jsonb array (string[] | null)
  - `apps/backend/apps/api/src/migrations/1768746000000-AddListNamesToEspConnection.ts` - Migration to add listNames column to esp_connections table
- **Learnings for future iterations:**
  - PostgreSQL jsonb columns can store arrays directly - use `jsonb` type for string[] arrays
  - Migration uses `ADD COLUMN IF NOT EXISTS` pattern for safe migration execution
  - The listNames field is nullable to maintain backward compatibility with existing connections
  - Different ESPs use different terminology (lists, segments, publications), but we store display names in listNames for UI consistency
  - The publicationIds field name is kept for backward compatibility, but listNames stores the human-readable names
---

## Mon Jan 19, 2026 - US-044
- **What was implemented**: Updated Publication interface to include metadata fields and comprehensive documentation
- **Files changed**:
  - `apps/backend/libs/core/src/esp/esp.interface.ts` - Enhanced Publication interface with optional common fields (subscriberCount, description, createdAt) and detailed documentation
- **Learnings for future iterations:**
  - The Publication interface is a code-level abstraction that represents different concepts depending on ESP: lists (Email Octopus, MailerLite, etc.), segments (Mailchimp), publications (Beehiiv, Kit), products (Omeda), recipient lists (SparkPost), contact lists (ActiveCampaign, Customer.io), clients' lists (Campaign Monitor), and site (Ghost)
  - Common optional fields used across connectors: subscriberCount/contactCount, description, createdAt, listType
  - The index signature `[key: string]: any` allows ESP-specific fields while maintaining type safety for common fields
  - All 17 ESP connectors are compatible with the updated interface (verified via backend build)
  - Interface documentation clarifies ESP terminology differences for future developers
---

## Mon Jan 19, 2026 - US-025
- **What was implemented**: Audited all 17 ESP connectors to document API versions and identify connectors that may need updates
- **Files changed**:
  - `ralph/esp-api-version-audit.md` - Comprehensive audit document documenting API versions for all 17 connectors
- **Learnings for future iterations:**
  - 10 connectors have explicit API versions in their URLs (Beehiiv v2, Kit v1, Mailchimp v3.0, Campaign Monitor v3.2, SparkPost v1, ActiveCampaign v3, Customer.io v1, Constant Contact v3, SendGrid v3, Brevo v3)
  - 7 connectors don't have version in URL (Email Octopus, Omeda, Ghost, Sailthru, MailerLite, PostUp, Iterable) - need to verify they're using latest APIs
  - Some connectors have API documentation links in comments (Campaign Monitor, Email Octopus, Omeda, Ghost, SparkPost, ActiveCampaign, Customer.io, Sailthru, MailerLite, PostUp, Constant Contact, Iterable, SendGrid, Brevo)
  - Missing documentation links: Beehiiv, Kit, Mailchimp
  - Email Octopus has potential version mismatch: documentation mentions v2 but connector may use v1.6
  - Connectors using v1 APIs (Kit, Customer.io, SparkPost) should be checked for v2+ availability
  - Audit document created at `ralph/esp-api-version-audit.md` for future reference
---

## Mon Jan 19, 2026 - US-026
- **What was implemented**: Updated beehiiv connector to add API documentation link and verify API version
- **Files changed**:
  - `apps/backend/libs/core/src/esp/beehiiv.connector.ts` - Added API documentation link and version note in class-level JSDoc comment
- **Learnings for future iterations:**
  - Beehiiv API v2 is the current version (verified January 2026)
  - API documentation URL: https://developers.beehiiv.com/docs
  - All API endpoints in the connector correctly use v2 via baseUrl constant
  - API documentation links should be added as comments in the class-level JSDoc block, following the pattern: "API Documentation: {url}" and "API Version: {version} (current as of {date})"
  - No API version update was needed - v2 is current
---

## Mon Jan 19, 2026 - US-027
- **What was implemented**: Updated Kit connector from v1 to v4 API and added API documentation link
- **Files changed**:
  - `apps/backend/libs/core/src/esp/kit.connector.ts` - Updated baseUrl from v1 to v4, added API documentation link and version note in class-level JSDoc comment
- **Learnings for future iterations:**
  - Kit API v4 is the current version (verified January 2026)
  - API documentation URL: https://developers.kit.com/v4
  - Found reference to Kit v4 API in other backend codebase (`backend/libs/esp/src/services/kit.service.ts`)
  - All API endpoints in the connector correctly use v4 via baseUrl constant
  - API endpoints remain compatible between v1 and v4 (same structure: /publications, /publications/{id}/subscribers)
  - Backend build passes with v4 API update
---

## Mon Jan 19, 2026 - US-028
- **What was implemented**: Updated Mailchimp connector to add API documentation link and verify API version
- **Files changed**:
  - `apps/backend/libs/core/src/esp/mailchimp.connector.ts` - Added API documentation link and version note in class-level JSDoc comment
- **Learnings for future iterations:**
  - Mailchimp API v3.0 is the current version (verified January 2026)
  - API documentation URL: https://mailchimp.com/developer/marketing/api/
  - All API endpoints in the connector correctly use v3.0 via baseUrl (e.g., `https://{dc}.api.mailchimp.com/3.0`)
  - Mailchimp uses datacenter-specific URLs - must fetch datacenter code from OAuth metadata endpoint first
  - No API version update was needed - v3.0 is current
  - Backend build passes
---

## Mon Jan 19, 2026 - US-029
- **What was implemented**: Updated Campaign Monitor connector to add API documentation link and verify API version
- **Files changed**:
  - `apps/backend/libs/core/src/esp/campaign-monitor.connector.ts` - Added API documentation link and version note in class-level JSDoc comment
- **Learnings for future iterations:**
  - Campaign Monitor API v3.2 is the current version (verified January 2026)
  - API documentation URL: https://www.campaignmonitor.com/api/v3.2/
  - All API endpoints in the connector correctly use v3.2 via baseUrl constant
  - API documentation links should be added as comments in the class-level JSDoc block, following the pattern: "API Documentation: {url}" and "API Version: {version} (current as of {date})"
  - No API version update was needed - v3.2 is current
  - Backend build and integration tests pass
---

## Mon Jan 19, 2026 - US-030
- **What was implemented**: Updated Email Octopus connector to add API version note and verify API version
- **Files changed**:
  - `apps/backend/libs/core/src/esp/email-octopus.connector.ts` - Added API version note in class-level JSDoc comment
- **Learnings for future iterations:**
  - Email Octopus API v2 is the current version (verified January 2026)
  - API documentation URL: https://emailoctopus.com/api-documentation/v2
  - All API endpoints in the connector correctly use v2 via Bearer token authentication
  - The connector was already using v2 API correctly (Bearer token auth, not query param auth from v1.6)
  - Base URL doesn't include version in path (`https://api.emailoctopus.com`) - common for APIs that route by version in headers or use single current version endpoint
  - API documentation link was already present, only version note was added
  - Backend build and integration tests pass
---

## Mon Jan 19, 2026 - US-031
- **What was implemented**: Updated Omeda connector to add API version note and verify API version
- **Files changed**:
  - `apps/backend/libs/core/src/esp/omeda.connector.ts` - Added API version note in class-level JSDoc comment
- **Learnings for future iterations:**
  - Omeda API uses current REST API without versioning in URL (no version number in base URL)
  - API documentation URL: https://developer.omeda.com/
  - All API endpoints in the connector correctly use the current REST API
  - API version note format for APIs without versioning: "Current REST API (no versioning in URL, current as of {date})"
  - Backend build and integration tests pass
---

## Mon Jan 19, 2026 - US-032
- **What was implemented**: Updated Ghost connector to add API version note and verify API version
- **Files changed**:
  - `apps/backend/libs/core/src/esp/ghost.connector.ts` - Added API version note in class-level JSDoc comment
- **Learnings for future iterations:**
  - Ghost API uses current Admin API without versioning in URL (no version number in base URL)
  - API documentation URL: https://ghost.org/docs/admin-api/
  - All API endpoints in the connector correctly use /ghost/api/admin/ (current Admin API path)
  - Ghost Admin API version is determined by the Ghost instance version, not the API path
  - API version note format for APIs without versioning: "Current Admin API (no versioning in URL, current as of {date})"
  - Backend build and integration tests pass
---

## Mon Jan 19, 2026 - US-033
- **What was implemented**: Updated SparkPost connector to add API version note and verify API version
- **Files changed**:
  - `apps/backend/libs/core/src/esp/sparkpost.connector.ts` - Added API version note in class-level JSDoc comment
- **Learnings for future iterations:**
  - SparkPost API v1 is the current version (verified January 2026)
  - API documentation URL: https://developers.sparkpost.com/api/
  - All API endpoints in the connector correctly use v1 via baseUrl constant
  - API documentation link was already present, only version note was added
  - SparkPost supports US and EU regions with "eu|" prefix in API key
  - API version note format: "API Version: v1 (current as of {date})"
  - Backend build and integration tests pass
---

## Mon Jan 19, 2026 - US-034
- **What was implemented**: Updated ActiveCampaign connector to add API version note and verify API version
- **Files changed**:
  - `apps/backend/libs/core/src/esp/active-campaign.connector.ts` - Added API version note in class-level JSDoc comment
- **Learnings for future iterations:**
  - ActiveCampaign API v3 is the current version (verified January 2026)
  - API documentation URL: https://developers.activecampaign.com/reference
  - All API endpoints in the connector correctly use v3 via baseUrl (getBaseUrl() method)
  - API documentation link was already present, only version note was added
  - ActiveCampaign uses account-specific base URLs: `https://{accountName}.api-us1.com/api/3`
  - API version note format: "API Version: v3 (current as of {date})"
  - Backend build and integration tests pass
---

## Mon Jan 19, 2026 - US-035
- **What was implemented**: Updated Customer.io connector to add API version note and verify API version
- **Files changed**:
  - `apps/backend/libs/core/src/esp/customer-io.connector.ts` - Added API version note in class-level JSDoc comment
- **Learnings for future iterations:**
  - Customer.io API v1 is the current version (verified January 2026)
  - API documentation URL: https://customer.io/docs/api/
  - All API endpoints in the connector correctly use v1 via baseUrl (getBaseUrl() method)
  - API documentation link was already present, only version note was added
  - Customer.io supports US and EU regions with "eu|" prefix in API key
  - Base URLs: US = `https://api.customer.io/v1`, EU = `https://api-eu.customer.io/v1`
  - API version note format: "API Version: v1 (current as of {date})"
  - Backend build and integration tests pass
---

## Mon Jan 19, 2026 - US-036
- **What was implemented**: Updated Sailthru connector to add API version note and verify API version
- **Files changed**:
  - `apps/backend/libs/core/src/esp/sailthru.connector.ts` - Added API version note in class-level JSDoc comment
- **Learnings for future iterations:**
  - Sailthru API uses current REST API without versioning in URL (no version number in base URL)
  - API documentation URL: https://getstarted.sailthru.com/developers/api-basics/
  - All API endpoints in the connector correctly use the current REST API
  - API documentation link was already present, only version note was added
  - API version note format for APIs without versioning: "API Version: Current REST API (no versioning in URL, current as of {date})"
  - Backend build and integration tests pass
---

## Mon Jan 19, 2026 - US-037
- **What was implemented**: Updated MailerLite connector to add API version note and verify API version
- **Files changed**:
  - `apps/backend/libs/core/src/esp/mailerlite.connector.ts` - Added API version note in class-level JSDoc comment
- **Learnings for future iterations:**
  - MailerLite API uses current Connect API without versioning in URL (no version number in base URL)
  - API documentation URL: https://developers.mailerlite.com/docs
  - All API endpoints in the connector correctly use the current Connect API via baseUrl (`https://connect.mailerlite.com/api`)
  - API documentation link was already present, only version note was added
  - API version note format for APIs without versioning: "API Version: Current Connect API (no versioning in URL, current as of {date})"
  - Backend build and integration tests pass
---

## Mon Jan 19, 2026 - US-038
- **What was implemented**: Updated PostUp connector to add API version note and verify API version
- **Files changed**:
  - `apps/backend/libs/core/src/esp/postup.connector.ts` - Added API version note in class-level JSDoc comment
- **Learnings for future iterations:**
  - PostUp API uses current REST API without versioning in URL (no version number in base URL)
  - API documentation URL: https://api.postup.com/docs/
  - All API endpoints in the connector correctly use the current REST API via baseUrl (`https://api.postup.com/api`)
  - API documentation link was already present, only version note was added
  - API version note format for APIs without versioning: "API Version: Current REST API (no versioning in URL, current as of {date})"
  - Backend build and integration tests pass
---

## Mon Jan 19, 2026 - US-039
- **What was implemented**: Updated Constant Contact connector to add API version note and verify API version
- **Files changed**:
  - `apps/backend/libs/core/src/esp/constant-contact.connector.ts` - Added API version note in class-level JSDoc comment
- **Learnings for future iterations:**
  - Constant Contact API v3 is the current API version (verified January 2026)
  - API documentation URLs: https://developer.constantcontact.com/api_guide/index.html and https://developer.constantcontact.com/api_reference/index.html
  - All API endpoints in the connector correctly use v3 via baseUrl (`https://api.cc.email/v3`)
  - API documentation links were already present, only version note was added
  - API version note format: "API Version: v3 (current as of {date})"
  - Backend build and integration tests pass
---

## Mon Jan 19, 2026 - US-040
- **What was implemented**: Updated Iterable connector to add API version note and verify API version
- **Files changed**:
  - `apps/backend/libs/core/src/esp/iterable.connector.ts` - Added API version note in class-level JSDoc comment
- **Learnings for future iterations:**
  - Iterable API uses current REST API without versioning in URL (no version number in base URL)
  - API documentation URL: https://api.iterable.com/api/docs
  - All API endpoints in the connector correctly use the current REST API via baseUrl (`https://api.iterable.com/api`)
  - API documentation link was already present, only version note was added
  - API version note format for APIs without versioning: "API Version: Current REST API (no versioning in URL, current as of {date})"
  - Backend build and integration tests pass
---

## Mon Jan 19, 2026 - US-041
- **What was implemented**: Updated SendGrid connector to add API version note and verify API version
- **Files changed**:
  - `apps/backend/libs/core/src/esp/sendgrid.connector.ts` - Added API version note in class-level JSDoc comment
- **Learnings for future iterations:**
  - SendGrid API v3 is the current API version (verified January 2026)
  - API documentation URL: https://docs.sendgrid.com/api-reference/marketing-campaigns/
  - All API endpoints in the connector correctly use v3 via baseUrl constant
  - API documentation link was already present, only version note was added
  - API version note format: "API Version: v3 (current as of {date})"
  - Backend build and integration tests pass
---

## Mon Jan 19, 2026 - US-042
- **What was implemented**: Updated Brevo connector to add API version note and verify API version
- **Files changed**:
  - `apps/backend/libs/core/src/esp/brevo.connector.ts` - Added API version note in class-level JSDoc comment
- **Learnings for future iterations:**
  - Brevo API v3 is the current API version (verified January 2026)
  - API documentation URL: https://developers.brevo.com/reference/getting-started-1
  - All API endpoints in the connector correctly use v3 via baseUrl constant
  - API documentation link was already present, only version note was added
  - API version note format: "API Version: v3 (current as of {date})"
  - Backend build and integration tests pass
---

## Mon Jan 19, 2026 - US-045
- **What was implemented**: Updated EspConnectionService.createConnection() to fetch and store list names alongside publication IDs
- **Files changed**:
  - `apps/backend/apps/api/src/services/esp-connection.service.ts` - Updated createConnection() method to fetch lists using connector.fetchPublications(), extract IDs and names, and store both publicationIds and listNames in database
- **Learnings for future iterations:**
  - fetchPublications() method returns lists/segments/publications depending on ESP terminology, but all conform to the Publication interface with id and name fields
  - Error handling is graceful - if fetchPublications() fails, connection creation continues with null listNames (user can update lists later)
  - Default behavior: all lists are selected (publicationIds contains all IDs from fetchPublications())
  - The publicationId parameter is kept for backward compatibility, but publicationIds (array) and listNames (array) are the new fields used for multiple list support
  - All 17 ESP connectors implement fetchPublications() method, so this works for all ESP types
  - Backend build passes with the changes
---

## Mon Jan 19, 2026 - US-046
- **What was implemented**: Updated OAuth connection flow to fetch and store list names alongside publication IDs
- **Files changed**:
  - `apps/backend/apps/api/src/services/esp-connection.service.ts` - Updated createOAuthConnection() method to fetch lists using connector.fetchPublicationsWithOAuth(), extract IDs and names, and store both publicationIds and listNames in database
- **Learnings for future iterations:**
  - fetchPublicationsWithOAuth() method returns lists/segments/publications depending on ESP terminology (same as fetchPublications() but for OAuth connections)
  - Error handling is graceful - if fetchPublicationsWithOAuth() fails, OAuth connection creation continues with null listNames (user can update lists later)
  - Default behavior: all lists are selected (publicationIds contains all IDs from fetchPublicationsWithOAuth())
  - The OAuth flow now mirrors the API key flow (createConnection) in terms of list fetching and storage
  - Both Kit and Mailchimp connectors support fetchPublicationsWithOAuth() method
  - Backend build passes with the changes
---

## Mon Jan 19, 2026 - US-047
- **What was implemented**: Created GET /esp-connections/:id/lists endpoint to fetch available lists from ESP connections
- **Files changed**:
  - `apps/backend/apps/api/src/services/esp-connection.service.ts` - Added fetchAvailableLists() method that handles both API key and OAuth authentication methods
  - `apps/backend/apps/api/src/controllers/esp-connection.controller.ts` - Added GET /esp-connections/:id/lists endpoint
- **Learnings for future iterations:**
  - The fetchAvailableLists() service method follows the same pattern as getSubscriberCount() - it handles both API_KEY and OAUTH auth methods
  - For OAuth connections, the method uses callOAuthConnectorMethodWithRetry() to automatically refresh tokens on 401 errors
  - The endpoint returns Publication[] which represents lists/segments/publications depending on ESP terminology
  - Error handling follows the same pattern as other endpoints: NotFoundException (404), BadRequestException (400), ForbiddenException (403), InternalServerErrorException (500)
  - The endpoint validates ownership via findById() which throws BadRequestException if user doesn't own the connection
  - All 17 ESP connectors support fetchPublications() or fetchPublicationsWithOAuth() methods, so the endpoint works for all ESP types
  - Backend build passes successfully
---

## Mon Jan 19, 2026 - US-048
- **What was implemented**: Created PUT /esp-connections/:id/lists endpoint to update selected lists for ESP connections
- **Files changed**:
  - `apps/backend/apps/api/src/dto/update-selected-lists.dto.ts` - New DTO for request body with selectedListIds validation
  - `apps/backend/apps/api/src/services/esp-connection.service.ts` - Added updateSelectedLists() method that validates list IDs and updates publicationIds and listNames
  - `apps/backend/apps/api/src/controllers/esp-connection.controller.ts` - Added PUT endpoint that handles request/response and error handling
- **Learnings for future iterations:**
  - The updateSelectedLists() service method validates list IDs by fetching available lists first, ensuring all provided IDs exist
  - The method updates both publicationIds (array) and listNames (array) fields, and also updates publicationId (single) for backward compatibility
  - Error handling follows the same pattern as other endpoints: NotFoundException (404), BadRequestException (400 with specific message for invalid IDs), ForbiddenException (403 for ownership issues), InternalServerErrorException (500)
  - The endpoint works for all 17 ESP types because it uses fetchAvailableLists() which handles both API_KEY and OAUTH authentication methods
  - The DTO uses class-validator decorators (@IsNotEmpty, @IsArray, @IsString) for request validation
  - Backend build and TypeScript checks pass successfully
---

## Mon Jan 19, 2026 - US-049
- **What was implemented**: Updated frontend API client to support list endpoints (getLists and updateSelectedLists)
- **Files changed**:
  - `apps/frontend/src/lib/api.ts` - Added List interface, UpdateSelectedListsRequest interface, listNames field to EspConnection interface, getLists() method, and updateSelectedLists() method
- **Learnings for future iterations:**
  - Frontend uses 'lists' terminology for clarity, even though backend may call them publications/segments depending on ESP
  - The List interface matches the backend Publication interface structure (id, name, subscriberCount, description, createdAt, plus index signature for ESP-specific fields)
  - Added listNames field to EspConnection interface to match backend schema
  - getLists() method fetches available lists from GET /esp-connections/:id/lists endpoint
  - updateSelectedLists() method updates selected lists via PUT /esp-connections/:id/lists endpoint with UpdateSelectedListsRequest body
  - Both methods follow the same pattern as other espConnectionApi methods (token, onUnauthorized callback, error handling)
  - Frontend build passes successfully, TypeScript checks pass
---

## Mon Jan 19, 2026 - US-050
- **What was implemented**: Created ListSelector component for selecting which lists to sync from an ESP connection
- **Files changed**:
  - `apps/frontend/src/components/ListSelector.tsx` - New component with checkbox functionality, Select All/Deselect All, loading states, error handling, and subscriber count display
- **Learnings for future iterations:**
  - Component uses 'lists' terminology in UI for consistency, even though backend may call them publications/segments depending on ESP
  - Uses native HTML checkbox with sr-only class for accessibility, with custom styled visual checkbox using Check icon from lucide-react
  - Component follows design system patterns: uses Card, CardHeader, CardTitle, CardContent from UI components, Button component, and cn() utility for className merging
  - Format subscriber counts with K/M suffixes for readability (e.g., "1.5K subscribers", "2.3M subscribers")
  - Component handles loading, error, and empty states gracefully
  - Default state is all lists selected (handled by parent component passing all list IDs)
  - Component is fully accessible with proper aria-labels and keyboard navigation support
  - Frontend build passes successfully, TypeScript checks pass
---

## Mon Jan 19, 2026 - US-051
- **What was implemented**: Updated onboarding flow to include list selection after API key validation
- **Files changed**:
  - `apps/frontend/src/app/onboarding/api-key/page.tsx` - Added two-step flow: API key validation → list selection → connection creation with selected lists
  - `apps/frontend/src/components/ListSelector.tsx` - Fixed unused variable lint warning
- **Learnings for future iterations:**
  - Onboarding flow now creates connection first (to validate API key and fetch lists), then updates selected lists via updateSelectedLists endpoint
  - Uses sessionStorage to temporarily store connection ID between validation and final submission
  - Publication ID is optional for most ESPs - if not provided, uses 'placeholder' and handles validation errors gracefully
  - Two-step form flow: first step validates API key and fetches lists, second step shows ListSelector and saves selection
  - Default behavior: all lists are selected when lists are fetched
  - Error handling: checks if error message mentions "publication" to provide helpful feedback when publicationId is required
  - Back button allows users to go back and modify API key/publicationId if needed
  - Frontend build and TypeScript checks pass successfully
---

## Mon Jan 19, 2026 - US-052
- **What was implemented**: Updated new ESP connection page to include list selection after API key validation
- **Files changed**:
  - `apps/frontend/src/app/dashboard/esp/new/page.tsx` - Added two-step flow: API key validation → list selection → connection creation with selected lists
- **Learnings for future iterations:**
  - New ESP connection page now follows the same pattern as onboarding API key page for consistency
  - Two-step form flow: first step validates API key and fetches lists, second step shows ListSelector and saves selection
  - Publication ID is optional (changed from required) - if not provided, uses 'placeholder' and handles validation errors gracefully
  - Default behavior: all lists are selected when lists are fetched
  - Error handling: checks if error message mentions "publication" to provide helpful feedback when publicationId is required
  - Back button behavior: from list selection goes back to API key form, from API key form goes back to ESP selection
  - Temporary connection is created during validation, then updated with selected lists before redirecting to detail page
  - If no lists are found, temporary connection is deleted and error is shown
  - OAuth flow is unchanged (will be updated in US-056)
  - Frontend build and TypeScript checks pass successfully
---
