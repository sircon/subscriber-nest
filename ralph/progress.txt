# Ralph Progress Log
Started: Sun Jan 18 15:17:58 CET 2026
---

## 2026-01-18 15:18 - US-001
- Created shared package directory structure at `packages/shared/src/` with all required subdirectories (entities, dto, services, events, interfaces, types)
- Updated root `package.json` to include `packages/*` in workspaces configuration
- Fixed linting error in `apps/frontend/next-env.d.ts` (prettier quote style)
- Files changed:
  - `package.json` - Added `packages/*` to workspaces
  - `apps/frontend/next-env.d.ts` - Fixed quote style for linting
  - Created directory structure: `packages/shared/src/{entities,dto,services,events,interfaces,types}/`
- **Learnings for future iterations:**
  - Empty directories are not tracked by git until files are added (this is expected behavior)
  - Root `package.json` workspaces must include both `apps/*` and `packages/*` for monorepo structure
  - Turborepo automatically recognizes new workspaces once added to root package.json
  - Use `yarn lint` and `yarn build` to verify changes don't break existing code
---

## 2026-01-18 15:25 - US-002
- Created `packages/shared/package.json` with name `@subscriber-nest/shared`, version, and proper exports configuration for all subdirectories (entities, dto, services, events, interfaces, types)
- Created `packages/shared/tsconfig.json` with TypeScript configuration matching backend settings (commonjs, ES2022 target, decorators enabled)
- Created index.ts files for all subdirectories with empty exports to make them valid TypeScript modules
- Configured TypeScript paths in `apps/backend/tsconfig.json` to include `@subscriber-nest/shared` and `@subscriber-nest/shared/*` aliases pointing to `../../packages/shared/src`
- Root `package.json` already had `packages/*` in workspaces from US-001
- Files changed:
  - `packages/shared/package.json` - Created with exports configuration
  - `packages/shared/tsconfig.json` - Created with TypeScript config
  - `packages/shared/src/index.ts` - Main entry point
  - `packages/shared/src/{entities,dto,services,events,interfaces,types}/index.ts` - Subdirectory entry points
  - `apps/backend/tsconfig.json` - Added path aliases for shared package
- **Learnings for future iterations:**
  - Empty TypeScript files need `export {};` to be recognized as modules
  - Shared package exports should use both `types` and `default` fields in package.json exports for proper TypeScript support
  - TypeScript path aliases in tsconfig.json use relative paths from the tsconfig.json location
  - Turborepo automatically builds all packages in workspaces when running `yarn build`
  - Package name should use scoped format `@subscriber-nest/shared` for monorepo packages
---

## 2026-01-18 16:15 - US-003
- Moved all 8 entity files from `apps/backend/src/entities/` to `packages/shared/src/entities/`:
  - billing-subscription.entity.ts
  - billing-usage.entity.ts
  - esp-connection.entity.ts
  - session.entity.ts
  - subscriber.entity.ts
  - sync-history.entity.ts
  - user.entity.ts
  - verification-code.entity.ts
- Updated all entity imports within entities to use relative paths (they reference each other using `./entity-name.entity`)
- Updated `packages/shared/src/entities/index.ts` to export all entities and their enums
- Updated all backend imports (24 files) to use `@subscriber-nest/shared/entities` instead of relative paths:
  - Controllers: subscriber, esp-connection, dashboard, billing, account, auth
  - Services: sync-history, subscriber, subscriber-sync, subscriber-mapper, subscriber-export, esp-connection, billing-usage, billing-subscription, auth
  - Processors: subscriber-sync, billing, account-deletion
  - Guards: subscription, auth
  - Decorators: current-user
  - DTOs: create-subscriber, create-esp-connection
  - app.module.ts
- Deleted old entity files from backend
- Files changed:
  - Created 8 entity files in `packages/shared/src/entities/`
  - Updated `packages/shared/src/entities/index.ts` to export all entities
  - Updated 24 files in `apps/backend/src/` to use shared package imports
  - Deleted 8 entity files from `apps/backend/src/entities/`
- **Learnings for future iterations:**
  - Entity files can reference each other using relative imports within the same directory (e.g., `./user.entity`)
  - When moving entities, update imports in: controllers, services, processors, guards, decorators, DTOs, and app.module.ts
  - Use `@subscriber-nest/shared/entities` import path for all entity imports after moving to shared package
  - All entities and their enums should be exported from `packages/shared/src/entities/index.ts`
  - Use `turbo run build --filter=backend` and `turbo run build --filter=@subscriber-nest/shared` to verify compilation
  - Use `yarn lint` to verify code style after moving files
---

## 2026-01-18 15:23 - US-004
- Moved all 2 DTO files from `apps/backend/src/dto/` to `packages/shared/src/dto/`:
  - create-esp-connection.dto.ts
  - create-subscriber.dto.ts
- Updated `packages/shared/src/dto/index.ts` to export both DTOs
- Updated all backend imports (3 files) to use `@subscriber-nest/shared/dto` instead of relative paths:
  - Controllers: esp-connection
  - Services: subscriber-mapper, subscriber
- Fixed imports within shared package DTOs to use relative paths (`../entities`) instead of package name imports (package name imports are for external consumers)
- Deleted old DTO files from backend
- Files changed:
  - Created 2 DTO files in `packages/shared/src/dto/`
  - Updated `packages/shared/src/dto/index.ts` to export both DTOs
  - Updated 3 files in `apps/backend/src/` to use shared package imports
  - Deleted 2 DTO files from `apps/backend/src/dto/`
- **Learnings for future iterations:**
  - Within the shared package itself, use relative imports (e.g., `../entities`) instead of package name imports (e.g., `@subscriber-nest/shared/entities`)
  - Package name imports (`@subscriber-nest/shared/*`) are for external packages that consume the shared package
  - When moving DTOs, update imports in: controllers and services
  - Use `@subscriber-nest/shared/dto` import path for all DTO imports after moving to shared package
  - All DTOs should be exported from `packages/shared/src/dto/index.ts`
  - Use `turbo run build --filter=backend --filter=@subscriber-nest/shared` to verify compilation
---

## 2026-01-18 15:25 - US-005
- Moved `EncryptionService` from `apps/backend/src/services/` to `packages/shared/src/services/`
- Added `@nestjs/common` and `@nestjs/config` as dependencies to `packages/shared/package.json`
- Updated `packages/shared/src/services/index.ts` to export `EncryptionService`
- Updated all backend imports (6 files) to use `@subscriber-nest/shared/services` instead of relative paths:
  - Controllers: subscriber
  - Services: subscriber-mapper, subscriber-sync, esp-connection, subscriber-export
  - app.module.ts
- Deleted old EncryptionService file from backend
- Files changed:
  - `packages/shared/package.json` - Added NestJS dependencies
  - Created `packages/shared/src/services/encryption.service.ts`
  - Updated `packages/shared/src/services/index.ts` to export EncryptionService
  - Updated 6 files in `apps/backend/src/` to use shared package imports
  - Deleted `apps/backend/src/services/encryption.service.ts`
- **Learnings for future iterations:**
  - When moving services to shared package, add their dependencies (e.g., `@nestjs/common`, `@nestjs/config`) to shared package.json
  - Services that depend on NestJS decorators (like `@Injectable()`) can be moved to shared package as long as dependencies are added
  - When moving services, update imports in: controllers, services, processors, and app.module.ts
  - Use `@subscriber-nest/shared/services` import path for all service imports after moving to shared package
  - All services should be exported from `packages/shared/src/services/index.ts`
  - Run `yarn install` after adding dependencies to shared package
  - Use `yarn workspace @subscriber-nest/shared typecheck` and `yarn exec tsc --noEmit` in backend to verify compilation
---

## 2026-01-18 15:27 - US-006
- Created API service directory structure at `apps/api/src/` with all required subdirectories (controllers, services, guards, decorators)
- Directory structure matches the backend structure for easy migration
- Files changed:
  - Created directory structure: `apps/api/src/{controllers,services,guards,decorators}/`
- **Learnings for future iterations:**
  - Empty directories are not tracked by git until files are added (this is expected behavior)
  - API service directory structure mirrors backend structure to facilitate migration
  - Use `yarn lint` to verify changes don't break existing code
  - Typecheck passes automatically when there are no TypeScript files to check
---

## 2026-01-19 - US-007
- Created `apps/api/package.json` with NestJS dependencies matching backend configuration
- Created `apps/api/tsconfig.json` with TypeScript configuration including paths to shared package (`@subscriber-nest/shared` and `@subscriber-nest/shared/*`)
- Created `apps/api/nest-cli.json` with NestJS CLI configuration
- Copied `apps/api/eslint.config.mjs` from backend for linting configuration
- Created minimal `apps/api/src/index.ts` placeholder file to allow typecheck to pass
- Root `package.json` already had `apps/*` in workspaces, so no update needed
- Files changed:
  - `apps/api/package.json` - Created with NestJS dependencies
  - `apps/api/tsconfig.json` - Created with TypeScript config and shared package paths
  - `apps/api/nest-cli.json` - Created with NestJS CLI config
  - `apps/api/eslint.config.mjs` - Copied from backend
  - `apps/api/src/index.ts` - Created minimal placeholder
- **Learnings for future iterations:**
  - Yarn 1.x (used in this project) doesn't support `workspace:*` protocol for workspace dependencies
  - Use TypeScript path aliases in tsconfig.json to reference shared package instead of adding it as a dependency
  - TypeScript config needs `include` and `exclude` fields when there are no source files yet (or create a minimal placeholder file)
  - Copy eslint.config.mjs from backend to maintain consistent linting configuration
  - Root package.json workspaces already includes `apps/*`, so new apps are automatically recognized
  - Use `yarn install` after creating package.json to install dependencies
  - Use `yarn lint --filter=api` and `yarn build --filter=api` to verify API service configuration
---

## 2026-01-19 - US-008
- Copied all 5 controller files from `apps/backend/src/controllers/` to `apps/api/src/controllers/`:
  - account.controller.ts
  - billing.controller.ts
  - dashboard.controller.ts
  - esp-connection.controller.ts
  - subscriber.controller.ts
- Copied `apps/backend/src/auth.controller.ts` to `apps/api/src/auth.controller.ts`
- Copied `apps/backend/src/app.controller.ts` to `apps/api/src/app.controller.ts`
- Created `apps/api/src/app.service.ts` (required by app.controller.ts)
- Verified all entity and DTO imports already use `@subscriber-nest/shared/entities` and `@subscriber-nest/shared/dto` (no updates needed)
- Files changed:
  - Created 7 controller files in `apps/api/src/controllers/` and `apps/api/src/`
  - Created `apps/api/src/app.service.ts`
- **Learnings for future iterations:**
  - Controllers already use shared package imports for entities and DTOs (from previous stories)
  - Controllers reference services, guards, and decorators that will be copied in US-009 and US-010
  - Type errors for missing services/guards/decorators are expected until those stories are completed
  - All entity and DTO imports correctly use `@subscriber-nest/shared/*` paths
  - Use `yarn lint --filter=api` to verify code style after copying controllers
  - Typecheck will show errors for missing dependencies until services/guards/decorators are copied
---
