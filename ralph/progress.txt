# Ralph Progress Log
Started: Sat Jan 17 2026
---

## Codebase Patterns
- TypeORM entities are automatically loaded via `autoLoadEntities: true` in TypeOrmModule configuration
- Migration files go in `src/migrations/` and are compiled to `dist/migrations/` for execution
- Use `yarn build` before running migrations to ensure compiled files exist
- Entity files use TypeORM decorators: `@Entity()`, `@Column()`, `@PrimaryGeneratedColumn()`, `@CreateDateColumn()`, `@UpdateDateColumn()`
- Foreign key relationships use `@ManyToOne()` and `@JoinColumn()` decorators
- Use `uuid` type for primary keys with `uuid_generate_v4()` default in migrations

## 2026-01-17 - US-001
- Created User, VerificationCode, and Session entities with all required fields
- Created migration file to create the three tables with proper relationships
- Files changed:
  - `apps/backend/src/entities/user.entity.ts` - User entity with email (unique), isOnboarded, timestamps
  - `apps/backend/src/entities/verification-code.entity.ts` - VerificationCode entity with 6-digit code, expiration, and used flag
  - `apps/backend/src/entities/session.entity.ts` - Session entity with token, userId foreign key, expiration
  - `apps/backend/src/migrations/1737000000000-CreateUserAndSessionEntities.ts` - Migration to create all three tables
- **Learnings for future iterations:**
  - TypeORM CLI path issue in yarn workspaces - migration generation failed, so created migration manually
  - Migration format: class implements `MigrationInterface` with `up()` and `down()` methods using `queryRunner.query()`
  - Use `uuid_generate_v4()` for UUID defaults in PostgreSQL migrations
  - Foreign keys should use `ON DELETE CASCADE` for sessions when user is deleted
  - All quality checks (typecheck, lint, build) passed successfully
---

## 2026-01-17 - US-002
- Created EspConnection entity with provider enum, apiKey field, and relationship to User
- Added OneToMany relationship from User to EspConnections
- Created migration to create esp_connections table with enum type and foreign key
- Files changed:
  - `apps/backend/src/entities/esp-connection.entity.ts` - EspConnection entity with provider enum (kit, beehiiv, mailchimp), apiKey, isActive, timestamps
  - `apps/backend/src/entities/user.entity.ts` - Added OneToMany relationship to EspConnections
  - `apps/backend/src/migrations/1737000001000-CreateEspConnectionEntity.ts` - Migration to create esp_connections table and esp_provider_enum type
- **Learnings for future iterations:**
  - TypeORM enum columns require creating the enum type in PostgreSQL migrations before using it in table creation
  - Use `@OneToMany()` decorator on the parent entity (User) and `@ManyToOne()` on the child entity (EspConnection)
  - API key encryption will be handled in the service layer (stored as text in DB for now)
  - Enum values in TypeORM are defined as a TypeScript enum and referenced in the Column decorator
  - All quality checks (typecheck, lint, build) passed successfully
---

## 2026-01-17 - US-003
- Set up Resend email service with EmailService class
- Installed `resend` package (not `@resend/node`)
- Updated .env.example with placeholder RESEND_API_KEY and documentation
- Created EmailService with sendVerificationCode method that uses Resend API
- Added EmailService to AppModule providers and exports
- Files changed:
  - `apps/backend/package.json` - Added resend dependency
  - `apps/backend/.env.example` - Added RESEND_API_KEY with placeholder and documentation
  - `apps/backend/src/email.service.ts` - New EmailService class with Resend integration
  - `apps/backend/src/app.module.ts` - Added EmailService to providers and exports
- **Learnings for future iterations:**
  - Resend package name is `resend`, not `@resend/node`
  - EmailService uses ConfigService to read RESEND_API_KEY from environment
  - Service throws error on initialization if RESEND_API_KEY is missing (fail-fast pattern)
  - EmailService is exported from AppModule so it can be injected into other modules
  - Basic HTML email template included in service (will be replaced with react-email template in US-004)
  - All quality checks (typecheck, lint, build) passed successfully
---

## 2026-01-17 - US-004
- Created react-email verification code template with professional styling
- Installed react-email, @react-email/components, react, and react-dom packages
- Created VerificationCodeEmail component in apps/backend/src/emails/verification-code-email.tsx
- Updated EmailService to use react-email render function to convert template to HTML
- Added JSX support to TypeScript configuration (jsx: "react")
- Files changed:
  - `apps/backend/package.json` - Added react-email, @react-email/components, react, react-dom dependencies
  - `apps/backend/tsconfig.json` - Added "jsx": "react" to compilerOptions
  - `apps/backend/src/emails/verification-code-email.tsx` - New email template component with professional styling
  - `apps/backend/src/email.service.ts` - Updated to use react-email template rendering
- **Learnings for future iterations:**
  - react-email requires React and react-dom to be installed even in backend projects
  - Use `render` from `@react-email/render` with `React.createElement` to render templates to HTML
  - Template components use JSX syntax, so TypeScript config needs `"jsx": "react"` option
  - react-email templates compile to JavaScript and are included in the build output
  - Use `{ pretty: true }` option in render() for formatted HTML output
  - All quality checks (typecheck, lint, build) passed successfully
---
