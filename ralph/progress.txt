# Ralph Progress Log
Started: Mon Jan 19 09:42:21 CET 2026

## Codebase Patterns
- ESP connectors are in `apps/backend/libs/core/src/esp/` and implement `IEspConnector` interface
- EspType enum is defined in `apps/backend/libs/database/src/entities/esp-connection.entity.ts`
- Migrations are in `apps/backend/apps/api/src/migrations/` and use TypeORM's MigrationInterface
- PostgreSQL enums use `ALTER TYPE ... ADD VALUE IF NOT EXISTS` for adding new values (cannot remove values)
- Backend lint command has a pre-existing ESLint config issue (glob patterns ignoring all files)
- Existing connectors use HttpService from @nestjs/axios with firstValueFrom() from rxjs for API calls
- ESP auth varies: Basic Auth (Campaign Monitor), API key in query params (Email Octopus), custom headers (Omeda), Bearer token, etc.
- Some ESPs use compound API keys (e.g., Omeda: "client:appid:inputid") - parse to extract components
- Ghost uses JWT authentication: API key format "siteUrl|id:secret", create JWT with HMAC-SHA256 signing
- SparkPost uses API key directly in Authorization header, supports US/EU regions with "eu|" prefix
- ActiveCampaign uses "accountName|apiKey" format for compound API key; base URL is `https://{accountName}.api-us1.com/api/3`
- Customer.io uses Bearer token auth, supports US/EU regions with "eu|" prefix; segment membership returns IDs only (need to fetch profiles separately)
- Sailthru uses signature-based auth (MD5 hash of secret + sorted values); API key format "apiKey|apiSecret"; subscriber export uses job-based approach
- MailerLite uses Bearer token auth; API URL `https://connect.mailerlite.com/api`; cursor-based pagination via links.next or meta.next_cursor
- PostUp uses Basic Auth with compound API key format "username:password"; API URL `https://api.postup.com/api`; lists = publications, recipients = subscribers
- Constant Contact uses Bearer token auth with OAuth access token; API URL `https://api.cc.email/v3`; cursor-based pagination; contact_lists = publications, contacts = subscribers
- Iterable uses Api-Key header auth; API URL `https://api.iterable.com/api`; lists = publications, users = subscribers; list sizes available in /lists response

---

## Mon Jan 19, 2026 - US-001
- **What was implemented**: Added 14 new ESP types to the EspType enum and created database migration
- **Files changed**:
  - `apps/backend/libs/database/src/entities/esp-connection.entity.ts` - Added 14 new enum values
  - `apps/backend/apps/api/src/migrations/1768745000000-AddNewEspTypes.ts` - Migration to add enum values to PostgreSQL
- **Learnings for future iterations:**
  - PostgreSQL enums cannot have values removed, only added - use `ADD VALUE IF NOT EXISTS`
  - Existing ESP types use snake_case format (e.g., 'campaign_monitor', not 'campaignMonitor')
  - The backend lint command fails due to ESLint config issue, but build passes
- Campaign Monitor uses Basic Auth with API key as username and empty password
- Campaign Monitor organizes lists under clients - need to iterate clients first, then get lists per client
---

## Mon Jan 19, 2026 - US-002
- **What was implemented**: Created Campaign Monitor ESP connector
- **Files changed**:
  - `apps/backend/libs/core/src/esp/campaign-monitor.connector.ts` - New connector implementing IEspConnector interface
- **Learnings for future iterations:**
  - Campaign Monitor uses Basic Auth (API key as username, empty password) - use `Buffer.from(apiKey + ':').toString('base64')`
  - API base URL is `https://api.createsend.com/api/v3.2`
  - Publications = clients' subscriber lists; need to fetch /clients.json then /clients/{id}/lists.json for each
  - Active subscribers at /lists/{listId}/active.json, unsubscribed at /lists/{listId}/unsubscribed.json
  - List stats (including subscriber count) available at /lists/{listId}/stats.json
  - Campaign Monitor supports up to 1000 records per page
---

## Mon Jan 19, 2026 - US-003
- **What was implemented**: Created Email Octopus ESP connector
- **Files changed**:
  - `apps/backend/libs/core/src/esp/email-octopus.connector.ts` - New connector implementing IEspConnector interface
- **Learnings for future iterations:**
  - Email Octopus uses API key authentication via query parameter (`api_key`)
  - API base URL is `https://emailoctopus.com/api/1.6`
  - Lists endpoint: GET /lists, List details: GET /lists/{listId}, Contacts: GET /lists/{listId}/contacts
  - Pagination uses `paging.next` to check for more pages, default limit is 100
  - Subscriber counts available in list details via `counts.subscribed`
  - Status values: SUBSCRIBED, UNSUBSCRIBED, PENDING, BOUNCED
  - Custom fields stored in `fields` object (FirstName, LastName, etc.)
---

## Mon Jan 19, 2026 - US-004
- **What was implemented**: Created Omeda ESP connector
- **Files changed**:
  - `apps/backend/libs/core/src/esp/omeda.connector.ts` - New connector implementing IEspConnector interface
- **Learnings for future iterations:**
  - Omeda is an audience development platform for media companies
  - API key format: "client:appid:inputid" - must be parsed to extract components
  - Base URL includes client identifier: `https://ows.omeda.com/webservices/rest/{client}`
  - Auth headers: `x-omeda-appid` for app ID, optional `x-omeda-inputid` for input ID
  - Products endpoint: GET /products/* (asterisk is required in URLs)
  - Audience query: POST /audience/query/* with ProductIds filter
  - Email status codes: A=Active, O=Opt-out, U=Unsubscribed, B=Bounced, I=Inactive
  - Supports up to 500 records per query with Pagination.Offset/Limit
  - Use CountOnly: true in query payload for efficient subscriber counts
---

## Mon Jan 19, 2026 - US-005
- **What was implemented**: Created Ghost ESP connector
- **Files changed**:
  - `apps/backend/libs/core/src/esp/ghost.connector.ts` - New connector implementing IEspConnector interface
- **Learnings for future iterations:**
  - Ghost uses Admin API with JWT authentication (not simple API key)
  - API key format: "siteUrl|id:secret" where id and secret are hex strings
  - JWT is signed using HMAC-SHA256 with the secret (hex decoded to bytes)
  - JWT header must include `kid` (key ID) and `typ: JWT`, `alg: HS256`
  - JWT payload: `iat`, `exp` (5 min), `aud: '/admin/'`
  - Ghost is single-site, so fetchPublications returns site info from /site/ endpoint
  - Members endpoint: GET /ghost/api/admin/members/ with page/limit params
  - Pagination info in response.meta.pagination (total, next, prev, page, pages)
  - Member status values: free, paid, comped (plus subscribed boolean for email opt-in)
  - Authorization header format: `Ghost {jwt_token}`
---

## Mon Jan 19, 2026 - US-006
- **What was implemented**: Created SparkPost ESP connector
- **Files changed**:
  - `apps/backend/libs/core/src/esp/sparkpost.connector.ts` - New connector implementing IEspConnector interface
- **Learnings for future iterations:**
  - SparkPost uses API key directly in Authorization header (no "Bearer" prefix)
  - Supports US and EU regions - use "eu|" prefix for EU (e.g., "eu|actual_api_key")
  - API base URL: `https://api.sparkpost.com/api/v1` (US) or `https://api.eu.sparkpost.com/api/v1` (EU)
  - Recipient lists are the publication equivalent: GET /recipient-lists
  - Recipients in a list: GET /recipient-lists/{id} with `show_recipients=true`
  - Subscriber count available via `total_accepted_recipients` in list metadata
  - No explicit status field - infer from `suppressed` or metadata fields
  - Name stored in `address.name` as full name - need to split for firstName/lastName
  - Custom data stored in `substitution_data` object
---

## Mon Jan 19, 2026 - US-007
- **What was implemented**: Created ActiveCampaign ESP connector
- **Files changed**:
  - `apps/backend/libs/core/src/esp/active-campaign.connector.ts` - New connector implementing IEspConnector interface
- **Learnings for future iterations:**
  - ActiveCampaign uses compound API key format: "accountName|apiKey"
  - API base URL is account-specific: `https://{accountName}.api-us1.com/api/3`
  - Authentication via `Api-Token` header (not Authorization header)
  - Lists endpoint: GET /lists with pagination via limit/offset params
  - Contacts endpoint: GET /contacts with `listid` param to filter by list
  - Status is numeric: 0=unconfirmed, 1=active, 2=unsubscribed, 3=bounced
  - Custom fields are in `fieldValues` array with `field` and `value` properties
  - List details include `subscriber_count` for efficient count queries
  - Default page size is 100
---

## Mon Jan 19, 2026 - US-008
- **What was implemented**: Created Customer.io ESP connector
- **Files changed**:
  - `apps/backend/libs/core/src/esp/customer-io.connector.ts` - New connector implementing IEspConnector interface
- **Learnings for future iterations:**
  - Customer.io uses Bearer token authentication with App API key
  - Supports US and EU regional data centers - use "eu|" prefix for EU (e.g., "eu|actual_api_key")
  - API base URL: `https://api.customer.io/v1` (US) or `https://api-eu.customer.io/v1` (EU)
  - Publications = segments; GET /segments endpoint returns all segments
  - Segment membership: GET /segments/{id}/membership returns only customer IDs
  - Must fetch individual customer profiles via GET /customers/{id}/attributes
  - Segment details include `count` or `customer_count` for subscriber counts
  - Customer attributes use Unix timestamps (seconds) for dates like `created_at`
  - Status inferred from `unsubscribed`, `email_bounced`, `email_pending` boolean fields
  - Custom fields are stored in flat structure on customer object
---

## Mon Jan 19, 2026 - US-009
- **What was implemented**: Created Sailthru ESP connector
- **Files changed**:
  - `apps/backend/libs/core/src/esp/sailthru.connector.ts` - New connector implementing IEspConnector interface
- **Learnings for future iterations:**
  - Sailthru uses signature-based authentication with API key and secret pair
  - API key format: "apiKey|apiSecret" (compound format separated by pipe)
  - Signature = MD5(secret + sorted_values_concatenated) for request signing
  - API base URL: `https://api.sailthru.com`
  - Lists are identified by name (not numeric ID) in Sailthru
  - GET /list returns all lists, GET /list?list={name} for specific list details
  - Subscriber export requires job-based approach: POST /job with job='export_list_data'
  - Must poll job status until complete, then download export file from export_url
  - Export format is JSON lines (one JSON object per line)
  - List details include `email_count` for subscriber counts
  - Status inferred from: optout_email (unsubscribed), hardbounce_time (bounced), valid (invalid)
  - Profile data contains first_name, last_name, or name field for full name
---

## Mon Jan 19, 2026 - US-010
- **What was implemented**: Created MailerLite ESP connector
- **Files changed**:
  - `apps/backend/libs/core/src/esp/mailerlite.connector.ts` - New connector implementing IEspConnector interface
- **Learnings for future iterations:**
  - MailerLite uses Bearer token authentication (Authorization: Bearer {api_key})
  - API base URL is `https://connect.mailerlite.com/api` (MailerLite Connect/New API)
  - Publications = groups; GET /groups endpoint returns all groups
  - Subscribers: GET /subscribers with filter[group]={group_id} to filter by group
  - Uses cursor-based pagination via links.next or meta.next_cursor
  - Group details include `active_count` for subscriber counts
  - Status values: active, unsubscribed, bounced, junk, unconfirmed
  - First name may be in fields.name or fields.first_name
  - Tags returned as array of objects with name property
---

## Mon Jan 19, 2026 - US-011
- **What was implemented**: Created PostUp ESP connector
- **Files changed**:
  - `apps/backend/libs/core/src/esp/postup.connector.ts` - New connector implementing IEspConnector interface
- **Learnings for future iterations:**
  - PostUp uses Basic Auth with compound API key format: "username:password" (colon-separated)
  - API base URL is `https://api.postup.com/api`
  - Publications = lists (mailing lists); GET /list endpoint returns all lists
  - Subscribers = recipients; GET /recipient with listId param to filter by list
  - Uses limit/offset pagination (limit up to 500 per request)
  - List details include `recipientCount` for subscriber counts
  - Status values: A=Active, U=Unsubscribed, H=Hard Bounce, S=Soft Bounce, C=Complaint, P=Pending
  - Demographics (custom fields) stored in `demographics` object
  - List IDs referenced by `listId`, recipient IDs by `recipientId`
---

## Mon Jan 19, 2026 - US-012
- **What was implemented**: Created Constant Contact ESP connector
- **Files changed**:
  - `apps/backend/libs/core/src/esp/constant-contact.connector.ts` - New connector implementing IEspConnector interface
- **Learnings for future iterations:**
  - Constant Contact uses OAuth 2.0 with Bearer token authentication (access token as API key)
  - API base URL is `https://api.cc.email/v3`
  - Publications = contact_lists; GET /contact_lists endpoint returns all lists
  - Subscribers = contacts; GET /contacts with `lists` param to filter by list ID
  - Uses cursor-based pagination via `cursor.next` field in response
  - Account validation via GET /account/summary endpoint
  - List details include `membership_count` for subscriber counts (use `include_membership_count=all`)
  - Contact status based on `permission_to_send`: implicit, explicit, pending_confirmation, unsubscribed, temp_hold, not_set
  - Custom fields stored in `custom_fields` array with `custom_field_id` and `value`
  - Max 50 records for lists, 500 for contacts per API request
---

## Mon Jan 19, 2026 - US-013
- **What was implemented**: Created Iterable ESP connector
- **Files changed**:
  - `apps/backend/libs/core/src/esp/iterable.connector.ts` - New connector implementing IEspConnector interface
- **Learnings for future iterations:**
  - Iterable is a growth marketing platform supporting email, SMS, and push
  - Uses `Api-Key` header for authentication (not Authorization header)
  - API base URL is `https://api.iterable.com/api`
  - Publications = lists; GET /lists endpoint returns all lists with sizes
  - Subscribers fetched via GET /lists/getUsers (returns emails/IDs), then individual user profiles via GET /users/{email}
  - List `size` field contains subscriber count
  - User data stored in `dataFields` object (firstName, lastName, custom fields)
  - Status inferred from: unsubscribedChannelIds (channel 0 = email), bounced, hardBounced, spamComplaint, emailVerified
  - User identifier can be email or userId
---
